<html>
	<head>
		<div id="div">
			Password
			<input type="password" id="password" name="password">
			<br>
			<input type="button" value="Submit" onclick="login()">
			<br>
			
		</div>
		<table id="messages" border=1>
			
		</table>
		<div id="button">
		
		</div>
		<script src = "/socket.io/socket.io.js"></script>
		<script>
			
			var socket = io();
			
			var div = document.getElementById("div");
			var password=document.getElementById("password");
			var messagesTable=document.getElementById("messages");
			var i,adminPassword,newPassword,numLowercase=0,numUppercase=0,numSpecialChar=0,numInt=0;
			var errorMessages;
			
			
			function login(){
				
				password.value=password.value.trim();
				
				if(password.value==adminPassword){
			
					
					div.innerHTML="";
					
					messagesTable.innerHTML='<tr>\
					<th>Id</th>\
					<th>To</th>\
					<th>From</th>\
					<th>Subject</th>\
					<th>Message</th>\
					<th>Date</th>\
					<th>Deleted</th>\
					</tr>';
					
					document.getElementById("button").innerHTML='<input type="button" value="Change Password" onclick="changeAdminPassword()">';
				
					socket.emit("getMessages");
				
				}
				
				else if(password.value!="Administrator@09"){
					alert("Wrong password");
				}
			}
			
			function changeAdminPassword(){
			
				newPassword=prompt("Enter the new administrator password").trim();
				
				errorMessages="";
					
				// check if password is empty
				if (newPassword.length==0) {
					errorMessages+="Password cannot be empty"+"\n";
				}
		
				// check password content 
				for(i=0;i<=newPassword.length-1;i++){
			
					if("abcdefghijklmnoqrstuvwxyz".search(newPassword[i]) !=-1){
						numLowercase++;
					}
			
					if("ABCDEFGHIJKLMNOQRSTUVWXYZ".search(newPassword[i]) !=-1){
						numUppercase++;
					}
			
					if("!@#$%^&*()".search(newPassword[i]) !=-1){
						numSpecialChar++;
					}
			
					if("1234567890".search(newPassword[i])!=-1){
						numInt++;
					}
				}
					
				// validate password 
				if(numLowercase == 0 && newPassword.length!=0){
					errorMessages+="At least one character must be lowercase in password"+"\n";
				}
					
				if(numUppercase == 0 && newPassword.length!=0){
					errorMessages+="At least one character must be uppercase in password"+"\n";
				}
					
				if(numSpecialChar==0 && newPassword.length!=0){
					errorMessages+="At least one character must be a special character in password"+"\n";
				}
					
				if(numInt==0 && newPassword.length!=0){
					errorMessages+="At least one character must be an integer in password"+"\n";
				}
        
				if(newPassword.length <8){
					errorMessages+="Password must be at least 8 characters long"+"\n";
				}
					
				if(errorMessages==""){
						
					socket.emit("changeAdminPassword",newPassword);
					alert("Administrator Password is now changed");
				}
				
				else if(errorMessages!=""){
					alert(errorMessages);
				}
			}

				socket.on("getMessage",function(message){
					
						messagesTable.innerHTML+='<tr>\
						<td>'+message.id+'</td>\
						<td>'+message.to+'</td>\
						<td>'+message.from+'</td>\
						<td>'+message.subject+'</td>\
						<td>'+message.message+'</td>\
						<td>'+message.date+'</td>\
						<td>'+message.deleted+'</td>\
						</tr>';

				});
				
				socket.emit("sendAdminPassword");
				
				socket.on("getAdminPassword",function(password){
					adminPassword=password;
				});
				
				socket.on("messagesUpdated",function(messages){
					
					messagesTable.innerHTML="";
					
					messagesTable.innerHTML='<tr>\
					<th>Id</th>\
					<th>To</th>\
					<th>From</th>\
					<th>Subject</th>\
					<th>Message</th>\
					<th>Date</th>\
					<th>Deleted</th>\
					</tr>';
					
					for(i=0;i<=messages.length-1;i++){
						
						messagesTable.innerHTML+='<tr>\
						<td>'+messages[i].id+'</td>\
						<td>'+messages[i].to+'</td>\
						<td>'+messages[i].from+'</td>\
						<td>'+messages[i].subject+'</td>\
						<td>'+messages[i].message+'</td>\
						<td>'+messages[i].date+'</td>\
						<td>'+messages[i].deleted+'</td>\
						</tr>';
						
					}
				});
			
					
		</script>
	
	</head>
</html>